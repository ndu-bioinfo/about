<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Experience</title>

    <!-- External CSS files -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Print.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.6.0/print.min.js"></script>
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js?v=1.0.1"></script>
    
    <!-- Showdown.js for Markdown conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>

</head>

<body>

    <!-- Buttons to trigger PDF download via different methods -->
    <button onclick="downloadPDF()">Download PDF (html2pdf.js)</button>
    <button onclick="printJS('resumeContent', 'html')">Download PDF (Print.js)</button>

    <!-- Embed the content of resume.md here -->
    <div id="resumeContent">
        Loading content...
    </div>

    <script>
        // Function to fetch and load the content of resume.md, then convert to HTML
        window.onload = function() {
            fetch('resume/resume.md')  // Path to your Markdown file
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load resume.md: ' + response.statusText);
                    }
                    return response.text();
                })
                .then(markdown => {
                    // Parse the markdown into HTML using showdown.js
                    var converter = new showdown.Converter();
                    var htmlContent = converter.makeHtml(markdown);

                    // Insert the HTML content into the div
                    document.getElementById('resumeContent').innerHTML = htmlContent;
                })
                .catch(error => {
                    console.error('Error loading resume.md:', error);
                    document.getElementById('resumeContent').innerHTML = 'Failed to load content.';
                });
        }

        // Function to download the content as PDF using html2pdf.js
        function downloadPDF() {
            var now = new Date();
            var dateTime = now.getFullYear() + '-' + 
                           (now.getMonth() + 1).toString().padStart(2, '0');
            var fileName = 'niudu_resume_' + dateTime;

            var element = document.getElementById('resumeContent');

            html2pdf()
            .from(element)
            .set({
                margin: [0.5, 0.5, 0.5, 0.5], // Half-inch margins all around for US letter size
                filename: fileName + '.pdf',
                html2canvas: {
                    scale: 2, // Increased scale for better quality and to avoid word chopping
                    useCORS: true // Ensures images or content loaded from other domains are handled properly
                },
                jsPDF: {
                    orientation: 'portrait', // Portrait mode
                    unit: 'in', // Unit set to inches
                    format: 'letter' // US Letter paper size (8.5 x 11 inches)
                }
            })
            .save();
        }
    </script>

</body>
</html>